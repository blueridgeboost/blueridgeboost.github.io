<!-- JS Plugins + Main script (safe version) -->

{{/* Collect only local assets as Hugo Resources; external URLs are output separately */}}
{{ $local := slice }}

{{ range site.Params.plugins.js }}
{{ if findRE "^https?://" .link }}
<script src="{{ .link }}" type="application/javascript" {{ .attributes | safeHTMLAttr }}></script>
{{ else }}
{{ with resources.Get .link }}
{{ $local = $local | append . }}
{{ end }}
{{ end }}
{{ end }}

{{ with resources.Get "js/script.js" }}
{{ $local = $local | append . }}
{{ end }}

{{ if gt (len $local) 0 }}
{{ $bundle := $local | resources.Concat "js/scripts.js" }}
{{ if hugo.IsProduction }}
{{ $bundle = $bundle | minify | fingerprint }}
{{ end }}

<script

crossorigin="anonymous"

{{ if hugo.IsProduction }}integrity="{{ $bundle.Data.Integrity }}"{{ end }}

src="{{ $bundle.RelPermalink }}"></script>

{{ end }}